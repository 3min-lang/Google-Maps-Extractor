<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Google Maps è³‡æ–™çˆ¬èŸ²ï½œApify è¡¨å–®</title>

  <!-- Tailwindï¼ˆCDN ç‰ˆï¼Œå…å»ºç½®ï¼‰ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['system-ui','Noto Sans TC','ui-sans-serif','-apple-system','Segoe UI','Roboto','Helvetica','Arial'] }
        }
      }
    };
  </script>

  <!-- React + Babelï¼ˆç€è¦½å™¨ç›´æ¥è·‘ JSXï¼‰ -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <meta name="color-scheme" content="light only">
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // ç°¡å–®çš„ inline SVG åœ–ç¤ºï¼ˆå–ä»£ lucide-reactï¼‰
    const Icon = {
      plus:(c="w-5 h-5") => <svg className={c} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M12 5v14m7-7H5"/></svg>,
      trash:(c="w-5 h-5") => <svg className={c} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M19 7l-1 12a2 2 0 01-2 2H8a2 2 0 01-2-2L5 7m3 0h8M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2"/></svg>,
      send:(c="w-5 h-5")  => <svg className={c} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M22 2L11 13"/><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M22 2l-7 20-4-9-9-4 20-7z"/></svg>,
      eye:(c="w-5 h-5")   => <svg className={c} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5s8.268 2.943 9.542 7c-1.274 4.057-5.065 7-9.542 7s-8.268-2.943-9.542-7z"/><circle cx="12" cy="12" r="3"/></svg>,
      copy:(c="w-5 h-5")  => <svg className={c} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2"/><rect x="8" y="8" width="12" height="12" rx="2"/></svg>,
      check:(c="w-5 h-5") => <svg className={c} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7"/></svg>,
      info:(c="w-4 h-4")  => <svg className={c} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" d="M13 16h-1v-4h-1m1-4h.01M12 22a10 10 0 100-20 10 10 0 000 20z"/></svg>
    };

    function ApifyCrawlerForm() {
      const [formData, setFormData] = useState({
        city: 'å°åŒ—å¸‚',
        maxCrawledPlacesPerSearch: 5,     // ç›´æ¥å­˜æ•¸å­—
        searchStringsArray: [''],
        placeMinimumStars: '',            // '' æˆ– æ•¸å­— 1-5
        website: 'allPlaces',             // allPlaces | onlyWithWebsite
        searchMatching: 'all'             // all | any | exact
      });
      const [showPreview, setShowPreview] = useState(false);
      const [copied, setCopied] = useState(false);
      const [sending, setSending] = useState(false);
      const [success, setSuccess] = useState(false);

      const taiwanCities = [
        'å°åŒ—å¸‚','æ–°åŒ—å¸‚','æ¡ƒåœ’å¸‚','å°ä¸­å¸‚','å°å—å¸‚','é«˜é›„å¸‚',
        'åŸºéš†å¸‚','æ–°ç«¹å¸‚','å˜‰ç¾©å¸‚','æ–°ç«¹ç¸£','è‹—æ —ç¸£','å½°åŒ–ç¸£',
        'å—æŠ•ç¸£','é›²æ—ç¸£','å˜‰ç¾©ç¸£','å±æ±ç¸£','å®œè˜­ç¸£','èŠ±è“®ç¸£',
        'å°æ±ç¸£','æ¾æ¹–ç¸£','é‡‘é–€ç¸£','é€£æ±Ÿç¸£'
      ];

      // ç”¢ç”Ÿ Apify JSONï¼ˆé—œéµï¼šå‹åˆ¥æ­£ç¢ºï¼‰
      const generateApifyJson = () => {
        const filtered = formData.searchStringsArray.map(s => s.trim()).filter(Boolean);
        return {
          city: formData.city,
          countryCode: "tw",
          language: "zh-TW",
          maxCrawledPlacesPerSearch: Number(formData.maxCrawledPlacesPerSearch) || 5,
          searchStringsArray: filtered,
          skipClosedPlaces: true,
          placeMinimumStars: formData.placeMinimumStars === '' ? '' : Number(formData.placeMinimumStars),
          website: formData.website,            // allPlaces / onlyWithWebsite
          searchMatching: formData.searchMatching
        };
      };

      const addSearchString = () =>
        setFormData(fd => ({ ...fd, searchStringsArray: [...fd.searchStringsArray, ''] }));

      const removeSearchString = (i) =>
        setFormData(fd => {
          const arr = fd.searchStringsArray.filter((_, idx) => idx !== i);
          return { ...fd, searchStringsArray: arr.length ? arr : [''] };
        });

      const updateSearchString = (i, val) =>
        setFormData(fd => {
          const arr = [...fd.searchStringsArray];
          arr[i] = val;
          return { ...fd, searchStringsArray: arr };
        });

      const copyToClipboard = async () => {
        try {
          await navigator.clipboard.writeText(JSON.stringify(generateApifyJson(), null, 2));
          setCopied(true); setTimeout(()=>setCopied(false), 1500);
        } catch { alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–ã€‚'); }
      };

      const ENDPOINT_N8N = "https://xin03.zeabur.app/webhook/apify001"; // â† æ›æˆä½ çš„ n8n Webhook
      const sendToN8N = async () => {
        if (!formData.searchStringsArray.some(s => s.trim())) {
          alert('è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹æœå°‹é—œéµå­—'); return;
        }
        setSending(true); setSuccess(false);
        try {
          const r = await fetch(ENDPOINT_N8N, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(generateApifyJson())
          });
          if (r.ok) { setSuccess(true); setTimeout(()=>setSuccess(false), 4000); }
          else { const t = await r.text(); alert('é€å‡ºå¤±æ•—ï¼š' + r.status + ' ' + t); }
        } catch(e) { alert('ç¶²è·¯éŒ¯èª¤ï¼š' + (e?.message || e)); }
        setSending(false);
      };

      return (
        <div className="min-h-screen">
          {/* Header */}
          <div className="bg-white shadow-sm border-b border-gray-200">
            <div className="max-w-6xl mx-auto px-6 py-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center text-white">
                  <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
                </div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-900">Google Maps è³‡æ–™çˆ¬èŸ²</h1>
                  <p className="text-sm text-gray-600">å¿«é€Ÿè¨­å®šä¸¦å•Ÿå‹•æ‚¨çš„è³‡æ–™æ”¶é›†ä»»å‹™</p>
                </div>
              </div>
            </div>
          </div>

          <div className="max-w-6xl mx-auto px-6 py-8">
            {success && (
              <div className="mb-8 bg-green-50 border border-green-200 rounded-xl p-4 animate-[fadein_.3s_ease-out]">
                <div className="flex items-center gap-3">
                  <div className="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                    {Icon.check("w-5 h-5")}
                  </div>
                  <div>
                    <h3 className="text-green-800 font-semibold">ä»»å‹™æäº¤æˆåŠŸï¼</h3>
                    <p className="text-green-700 text-sm">æ‚¨çš„çˆ¬èŸ²ä»»å‹™å·²é–‹å§‹åŸ·è¡Œï¼Œè«‹ç¨å¾ŒæŸ¥çœ‹çµæœã€‚</p>
                  </div>
                </div>
              </div>
            )}

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              {/* Main Form */}
              <div className="lg:col-span-2">
                <div className="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                  <div className="bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-6 border-b border-gray-200">
                    <h2 className="text-xl font-semibold text-gray-900">è¨­å®šæœå°‹æ¢ä»¶</h2>
                    <p className="text-gray-600 text-sm mt-1">å¡«å…¥æ‚¨æƒ³è¦çˆ¬å–çš„åœ°é»å’Œæ¢ä»¶</p>
                  </div>

                  <div className="p-8 space-y-8">
                    {/* åŸå¸‚ */}
                    <div className="space-y-3">
                      <label className="flex items-center gap-2 text-lg font-semibold text-gray-800">
                        <span className="w-2 h-2 bg-blue-500 rounded-full"></span> æœå°‹åœ°å€
                      </label>
                      <select
                        value={formData.city}
                        onChange={(e)=>setFormData({...formData, city:e.target.value})}
                        className="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-blue-500 focus:bg-white transition-all duration-200 text-lg"
                      >
                        {taiwanCities.map(c => <option key={c} value={c}>{c}</option>)}
                      </select>
                    </div>

                    {/* é—œéµå­— */}
                    <div className="space-y-3">
                      <label className="flex items-center gap-2 text-lg font-semibold text-gray-800">
                        <span className="w-2 h-2 bg-green-500 rounded-full"></span> æœå°‹é—œéµå­— <span className="text-red-500 text-sm">*</span>
                      </label>

                      <div className="space-y-3">
                        {formData.searchStringsArray.map((v, idx) => (
                          <div key={idx} className="flex gap-3">
                            <input
                              type="text"
                              value={v}
                              onChange={(e)=>updateSearchString(idx, e.target.value)}
                              placeholder="ä¾‹å¦‚ï¼šä¿å¥é£Ÿå“ã€é¤å»³ã€ç¾å®¹é™¢"
                              className="flex-1 px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-green-500 focus:bg-white transition-all duration-200 text-lg"
                            />
                            <button
                              type="button"
                              onClick={()=>removeSearchString(idx)}
                              disabled={formData.searchStringsArray.length===1}
                              className="w-12 h-12 flex items-center justify-center text-red-500 hover:text-red-700 hover:bg-red-50 rounded-xl transition disabled:text-gray-400 disabled:cursor-not-allowed disabled:hover:bg-transparent"
                              title="åˆªé™¤"
                            >
                              {Icon.trash()}
                            </button>
                          </div>
                        ))}
                      </div>

                      <button type="button" onClick={addSearchString}
                        className="flex items-center gap-2 px-4 py-2 text-green-600 hover:text-green-800 hover:bg-green-50 rounded-lg transition">
                        {Icon.plus()} æ–°å¢é—œéµå­—
                      </button>
                    </div>

                    {/* é€²éšè¨­å®š */}
                    <div className="space-y-6">
                      <label className="flex items-center gap-2 text-lg font-semibold text-gray-800">
                        <span className="w-2 h-2 bg-purple-500 rounded-full"></span> é€²éšè¨­å®š
                      </label>

                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {/* æ¯æ¬¡æœå°‹æœ€å¤§çˆ¬å–æ•¸é‡ï¼ˆå­˜æ•¸å­—ï¼‰ */}
                        <div className="space-y-2">
                          <label className="block text-sm font-medium text-gray-700">æ¯æ¬¡æœå°‹æœ€å¤§çˆ¬å–æ•¸é‡</label>
                          <input
                            type="number" min="1" max="500"
                            value={formData.maxCrawledPlacesPerSearch}
                            onChange={(e)=>setFormData({...formData, maxCrawledPlacesPerSearch: Number(e.target.value) })}
                            className="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 focus:bg-white transition"
                            placeholder="é è¨­ï¼š5"
                          />
                        </div>

                        {/* æœ€ä½è©•åˆ†ï¼ˆè½‰æ•¸å­—æˆ–ç©ºå­—ä¸²ï¼‰ */}
                        <div className="space-y-2">
                          <label className="block text-sm font-medium text-gray-700">æœ€ä½è©•åˆ†ç¯©é¸</label>
                          <select
                            value={formData.placeMinimumStars === '' ? '' : Number(formData.placeMinimumStars)}
                            onChange={(e)=>setFormData({
                              ...formData,
                              placeMinimumStars: e.target.value === '' ? '' : Number(e.target.value)
                            })}
                            className="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 focus:bg-white transition"
                          >
                            <option value="">ä¸ç¯©é¸</option>
                            <option value={1}>â­ 1 æ˜Ÿä»¥ä¸Š</option>
                            <option value={2}>â­ 2 æ˜Ÿä»¥ä¸Š</option>
                            <option value={3}>â­ 3 æ˜Ÿä»¥ä¸Š</option>
                            <option value={4}>â­ 4 æ˜Ÿä»¥ä¸Š</option>
                            <option value={5}>â­ 5 æ˜Ÿ</option>
                          </select>
                        </div>

                        {/* ç¶²ç«™è³‡è¨Šç¯©é¸ï¼ˆå°é½Š allPlaces/onlyWithWebsiteï¼‰ */}
                        <div className="space-y-2">
                          <label className="block text-sm font-medium text-gray-700">ç¶²ç«™è³‡è¨Šç¯©é¸</label>
                          <select
                            value={formData.website}
                            onChange={(e)=>setFormData({...formData, website:e.target.value})}
                            className="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 focus:bg-white transition"
                          >
                            <option value="allPlaces">ğŸŒ æ‰€æœ‰åœ°é»</option>
                            <option value="onlyWithWebsite">âœ… åƒ…æœ‰ç¶²ç«™çš„åœ°é»</option>
                          </select>
                        </div>

                        {/* æœå°‹åŒ¹é…æ–¹å¼ */}
                        <div className="space-y-2">
                          <label className="block text-sm font-medium text-gray-700">æœå°‹åŒ¹é…æ–¹å¼</label>
                          <select
                            value={formData.searchMatching}
                            onChange={(e)=>setFormData({...formData, searchMatching:e.target.value})}
                            className="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-purple-500 focus:bg-white transition"
                          >
                            <option value="all">ğŸ” å…¨éƒ¨åŒ¹é…</option>
                            <option value="any">ğŸ§© ä»»ä¸€åŒ¹é…</option>
                            <option value="exact">ğŸ¯ ç²¾ç¢ºåŒ¹é…</option>
                          </select>
                        </div>
                      </div>
                    </div>

                  </div>
                </div>
              </div>

              {/* å³å´ï¼šå‹•ä½œ + èªªæ˜ */}
              <div className="space-y-6">
                <div className="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                  <div className="bg-gradient-to-r from-indigo-50 to-purple-50 px-6 py-4 border-b border-gray-200">
                    <h3 className="text-lg font-semibold text-gray-900">åŸ·è¡Œå‹•ä½œ</h3>
                  </div>
                  <div className="p-6 space-y-4">
                    <button type="button" onClick={()=>setShowPreview(s=>!s)}
                      className="w-full flex items-center justify-center gap-3 px-6 py-4 bg-gray-50 hover:bg-gray-100 text-gray-700 rounded-xl transition border-2 border-transparent hover:border-gray-200">
                      {Icon.eye()} {showPreview ? 'éš±è—é è¦½' : 'é è¦½ JSON'}
                    </button>

                    <button type="button" onClick={copyToClipboard}
                      className="w-full flex items-center justify-center gap-3 px-6 py-4 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-xl transition border-2 border-transparent hover:border-blue-200">
                      {copied ? Icon.check() : Icon.copy()} {copied ? 'å·²è¤‡è£½ï¼' : 'è¤‡è£½ JSON'}
                    </button>

                    <button type="button" onClick={sendToN8N}
                      disabled={sending || !formData.searchStringsArray.some(s=>s.trim())}
                      className="w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 disabled:from-gray-400 disabled:to-gray-400 text-white rounded-xl transition shadow-lg hover:shadow-xl disabled:cursor-not-allowed">
                      {Icon.send()} {sending ? 'åŸ·è¡Œä¸­â€¦' : 'é–‹å§‹çˆ¬å–'}
                    </button>
                    <div className="text-xs text-gray-500 text-center">é»æ“Šã€Œé–‹å§‹çˆ¬å–ã€å°‡è³‡æ–™é€è‡³ n8n è‡ªå‹•åŒ–æµç¨‹</div>
                  </div>
                </div>

                <div className="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl p-6 border border-blue-200">
                  <div className="flex items-center gap-3 mb-4">
                    <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white">
                      {Icon.info()}
                    </div>
                    <h3 className="text-lg font-semibold text-blue-900">ä½¿ç”¨èªªæ˜</h3>
                  </div>
                  <ul className="space-y-2 text-sm text-blue-800">
                    <li className="flex items-start gap-2"><span className="w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"></span> é¸æ“‡å°ç£åœ°å€åŸå¸‚</li>
                    <li className="flex items-start gap-2"><span className="w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"></span> è¼¸å…¥è‡³å°‘ä¸€å€‹æœå°‹é—œéµå­—</li>
                    <li className="flex items-start gap-2"><span className="w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"></span> ï¼ˆå¯é¸ï¼‰è¨­å®šé€²éšæ¢ä»¶</li>
                    <li className="flex items-start gap-2"><span className="w-1.5 h-1.5 bg-blue-500 rounded-full mt-2"></span> é€å‡ºå¾Œåˆ°å¾Œå°æŸ¥çœ‹çµæœ</li>
                  </ul>
                </div>
              </div>
            </div>

            {/* JSON é è¦½ */}
            {showPreview && (
              <div className="mt-8 bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
                <div className="bg-gradient-to-r from-gray-50 to-gray-100 px-8 py-4 border-b border-gray-200 flex items-center justify-between">
                  <h3 className="text-lg font-semibold text-gray-900">JSON é è¦½</h3>
                  <button onClick={copyToClipboard}
                          className="flex items-center gap-2 px-4 py-2 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition">
                    {copied ? Icon.check("w-4 h-4") : Icon.copy("w-4 h-4")} {copied ? 'å·²è¤‡è£½' : 'è¤‡è£½'}
                  </button>
                </div>
                <div className="p-8">
                  <pre className="bg-gray-900 text-gray-50 p-6 rounded-xl overflow-auto text-sm leading-relaxed">
{JSON.stringify(generateApifyJson(), null, 2)}
                  </pre>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<ApifyCrawlerForm/>);
  </script>

  <style>
    @keyframes fadein { from {opacity:0; transform: translateY(-6px)} to{opacity:1; transform:none} }
    .animate-\[fadein_.3s_ease-out] { animation: fadein .3s ease-out; }
  </style>
</body>
</html>
